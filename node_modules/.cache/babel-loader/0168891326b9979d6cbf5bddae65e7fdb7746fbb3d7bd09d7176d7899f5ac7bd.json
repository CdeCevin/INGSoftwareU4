{"ast":null,"code":"// Copyright (c) 2022, 2023, Oracle and/or its affiliates.\n\n//-----------------------------------------------------------------------------\n//\n// This software is dual-licensed to you under the Universal Permissive License\n// (UPL) 1.0 as shown at https://oss.oracle.com/licenses/upl and Apache License\n// 2.0 as shown at http://www.apache.org/licenses/LICENSE-2.0. You may choose\n// either license.\n//\n// If you elect to accept the software under the Apache License, Version 2.0,\n// the following applies:\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    https://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n//-----------------------------------------------------------------------------\n\n'use strict';\n\nconst crypto = require('crypto');\nconst path = require('path');\nconst constants = require(\"./constants.js\");\nconst fs = require(\"fs\");\n\n/**\n   * Generate UUID (Used for Connection ID)\n   * @returns Promise\n   */\nasync function genuuid() {\n  return await new Promise((resolve, reject) => {\n    crypto.randomBytes(16, (err, buf) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(buf);\n      }\n    });\n  });\n}\n\n/**\n * Network Session Attributes\n */\nclass SessionAtts {\n  constructor(uuid) {\n    this.largeSDU = false;\n    this.tdu = constants.NSPDFTDULN;\n    this.nt = {};\n    this.nt.tcpNoDelay = true;\n    this.uuid = uuid;\n    this.nt.sslServerDNMatch = true;\n    this.nt.sslAllowWeakDNMatch = false;\n  }\n\n  /**\n   * Update Session attributes with input Parameters\n   * @param {object} Params Input paramters\n   */\n  setFrom(params) {\n    if (params) {\n      if (params.sdu > 0) {\n        this.sdu = parseInt(params.sdu);\n      }\n      if (typeof params.walletLocation === 'string') {\n        this.nt.walletFile = path.join(params.walletLocation, constants.PEM_WALLET_FILE_NAME);\n      }\n      if (typeof params.walletPassword === 'string') {\n        this.nt.walletPassword = params.walletPassword;\n      }\n      if (typeof params.walletContent === 'string') {\n        this.nt.wallet = params.walletContent;\n      }\n      if (params.expireTime > 0) {\n        this.nt.expireTime = params.expireTime * 1000 * 60;\n      }\n      if (params.connectTimeout > 0) {\n        this.connectTimeout = params.connectTimeout * 1000;\n      }\n      if (params.transportConnectTimeout > 0) {\n        this.transportConnectTimeout = params.transportConnectTimeout * 1000;\n      }\n      if (params.recvTimeout > 0) {\n        this.recvTimeout = params.recvTimeout * 1000;\n      }\n      if (params.sendTimeout > 0) {\n        this.sendTimeout = params.sendTimeout * 1000;\n      }\n      if (typeof params.connectionIdPrefix === 'string') {\n        this.connectionIdPrefix = params.connectionIdPrefix;\n      }\n      if (typeof params.tcpNoDelay === 'boolean') {\n        this.nt.tcpNoDelay = params.tcpNoDelay;\n      }\n      if (typeof params.sslServerDNMatch === 'boolean') {\n        this.nt.sslServerDNMatch = params.sslServerDNMatch;\n      }\n      if (typeof params.sslAllowWeakDNMatch === 'boolean') {\n        this.nt.sslAllowWeakDNMatch = params.sslAllowWeakDNMatch;\n      }\n      if (typeof params.sslServerCertDN === 'string') {\n        this.nt.sslServerCertDN = params.sslServerCertDN;\n      }\n      if (typeof params.enable === 'string' && params.enable.toUpperCase() == \"BROKEN\") {\n        this.nt.enabledDCD = true;\n      }\n      if (typeof params.httpsProxy === 'string') {\n        this.nt.httpsProxy = params.httpsProxy;\n      }\n      if (params.httpsProxyPort >= 0) {\n        this.nt.httpsProxyPort = parseInt(params.httpsProxyPort);\n      }\n    }\n  }\n\n  /**\n   * Read wallet\n   * @returns Promise\n   */\n  readWalletFile() {\n    return new Promise((resolve, reject) => {\n      fs.readFile(this.nt.walletFile, (err, data) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(data);\n        }\n      });\n    });\n  }\n\n  /**\n   * Clear wallet\n   */\n  clearWallet() {\n    if (this.nt.wallet && Buffer.isBuffer(this.nt.wallet)) this.nt.wallet.fill(0);\n    this.nt.wallet = null;\n  }\n\n  /**\n   * Prepare attributes for connection, Generate Connection ID and read Wallet file\n   *\n   */\n  async prepare(protocol) {\n    if (!this.uuid) {\n      this.uuid = await genuuid();\n      this.uuid = this.uuid.toString('base64');\n    }\n    if (this.connectionIdPrefix) {\n      this.connectionId = this.connectionIdPrefix + this.uuid;\n    } else {\n      this.connectionId = this.uuid;\n    }\n    this.nt.connectionId = this.connectionId;\n    if (protocol && protocol.toUpperCase() == \"TCPS\" && !this.nt.wallet && this.nt.walletFile) {\n      this.nt.wallet = await this.readWalletFile();\n    }\n    if (!this.connectTimeout && !this.transportConnectTimeout) this.transportConnectTimeout = 60 * 1000; /* Default to 60 secs */\n  }\n}\nmodule.exports = SessionAtts;","map":{"version":3,"names":["crypto","require","path","constants","fs","genuuid","Promise","resolve","reject","randomBytes","err","buf","SessionAtts","constructor","uuid","largeSDU","tdu","NSPDFTDULN","nt","tcpNoDelay","sslServerDNMatch","sslAllowWeakDNMatch","setFrom","params","sdu","parseInt","walletLocation","walletFile","join","PEM_WALLET_FILE_NAME","walletPassword","walletContent","wallet","expireTime","connectTimeout","transportConnectTimeout","recvTimeout","sendTimeout","connectionIdPrefix","sslServerCertDN","enable","toUpperCase","enabledDCD","httpsProxy","httpsProxyPort","readWalletFile","readFile","data","clearWallet","Buffer","isBuffer","fill","prepare","protocol","toString","connectionId","module","exports"],"sources":["C:/Users/Koliv/Desktop/Software/my-react-app/node_modules/oracledb/lib/thin/sqlnet/sessionAtts.js"],"sourcesContent":["// Copyright (c) 2022, 2023, Oracle and/or its affiliates.\n\n//-----------------------------------------------------------------------------\n//\n// This software is dual-licensed to you under the Universal Permissive License\n// (UPL) 1.0 as shown at https://oss.oracle.com/licenses/upl and Apache License\n// 2.0 as shown at http://www.apache.org/licenses/LICENSE-2.0. You may choose\n// either license.\n//\n// If you elect to accept the software under the Apache License, Version 2.0,\n// the following applies:\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    https://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n//-----------------------------------------------------------------------------\n\n'use strict';\n\nconst crypto = require('crypto');\nconst path = require('path');\nconst constants = require(\"./constants.js\");\nconst fs = require(\"fs\");\n\n/**\n   * Generate UUID (Used for Connection ID)\n   * @returns Promise\n   */\nasync function genuuid() {\n  return await new Promise((resolve, reject) => {\n    crypto.randomBytes(16, (err, buf) => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(buf);\n      }\n    });\n  });\n}\n\n/**\n * Network Session Attributes\n */\nclass SessionAtts {\n\n  constructor(uuid) {\n    this.largeSDU = false;\n    this.tdu = constants.NSPDFTDULN;\n    this.nt = {};\n    this.nt.tcpNoDelay = true;\n    this.uuid = uuid;\n    this.nt.sslServerDNMatch = true;\n    this.nt.sslAllowWeakDNMatch = false;\n  }\n\n  /**\n   * Update Session attributes with input Parameters\n   * @param {object} Params Input paramters\n   */\n  setFrom(params) {\n    if (params) {\n      if (params.sdu > 0) {\n        this.sdu = parseInt(params.sdu);\n      }\n      if (typeof params.walletLocation === 'string') {\n        this.nt.walletFile = path.join(params.walletLocation, constants.PEM_WALLET_FILE_NAME);\n      }\n      if (typeof params.walletPassword === 'string') {\n        this.nt.walletPassword = params.walletPassword;\n      }\n      if (typeof params.walletContent === 'string') {\n        this.nt.wallet = params.walletContent;\n      }\n      if (params.expireTime > 0) {\n        this.nt.expireTime = params.expireTime * 1000 * 60;\n      }\n      if (params.connectTimeout > 0) {\n        this.connectTimeout = params.connectTimeout * 1000;\n      }\n      if (params.transportConnectTimeout > 0) {\n        this.transportConnectTimeout = params.transportConnectTimeout * 1000;\n      }\n      if (params.recvTimeout > 0) {\n        this.recvTimeout = params.recvTimeout * 1000;\n      }\n      if (params.sendTimeout > 0) {\n        this.sendTimeout = params.sendTimeout * 1000;\n      }\n      if (typeof params.connectionIdPrefix === 'string') {\n        this.connectionIdPrefix = params.connectionIdPrefix;\n      }\n      if (typeof params.tcpNoDelay === 'boolean') {\n        this.nt.tcpNoDelay = params.tcpNoDelay;\n      }\n      if (typeof params.sslServerDNMatch === 'boolean') {\n        this.nt.sslServerDNMatch = params.sslServerDNMatch;\n      }\n      if (typeof params.sslAllowWeakDNMatch === 'boolean') {\n        this.nt.sslAllowWeakDNMatch = params.sslAllowWeakDNMatch;\n      }\n      if (typeof params.sslServerCertDN === 'string') {\n        this.nt.sslServerCertDN = params.sslServerCertDN;\n      }\n      if (typeof params.enable === 'string' && params.enable.toUpperCase() == \"BROKEN\") {\n        this.nt.enabledDCD = true;\n      }\n      if (typeof params.httpsProxy === 'string') {\n        this.nt.httpsProxy = params.httpsProxy;\n      }\n      if (params.httpsProxyPort >= 0) {\n        this.nt.httpsProxyPort = parseInt(params.httpsProxyPort);\n      }\n    }\n  }\n\n  /**\n   * Read wallet\n   * @returns Promise\n   */\n  readWalletFile() {\n    return new Promise((resolve, reject)=> {\n      fs.readFile(this.nt.walletFile, (err, data) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(data);\n        }\n      });\n    });\n  }\n\n  /**\n   * Clear wallet\n   */\n  clearWallet() {\n    if (this.nt.wallet && Buffer.isBuffer(this.nt.wallet))\n      this.nt.wallet.fill(0);\n    this.nt.wallet = null;\n  }\n\n  /**\n   * Prepare attributes for connection, Generate Connection ID and read Wallet file\n   *\n   */\n  async prepare(protocol) {\n    if (!this.uuid) {\n      this.uuid = await genuuid();\n      this.uuid = this.uuid.toString('base64');\n    }\n    if (this.connectionIdPrefix) {\n      this.connectionId = this.connectionIdPrefix + this.uuid;\n    } else {\n      this.connectionId = this.uuid;\n    }\n    this.nt.connectionId = this.connectionId;\n\n    if (protocol && (protocol.toUpperCase() == \"TCPS\" && !this.nt.wallet && this.nt.walletFile)) {\n      this.nt.wallet = await this.readWalletFile();\n    }\n\n    if (!this.connectTimeout && !this.transportConnectTimeout)\n      this.transportConnectTimeout = 60 * 1000; /* Default to 60 secs */\n  }\n\n}\n\nmodule.exports = SessionAtts;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}