{"ast":null,"code":"// Copyright (c) 2022, 2023, Oracle and/or its affiliates.\n\n//-----------------------------------------------------------------------------\n//\n// This software is dual-licensed to you under the Universal Permissive License\n// (UPL) 1.0 as shown at https://oss.oracle.com/licenses/upl and Apache License\n// 2.0 as shown at http://www.apache.org/licenses/LICENSE-2.0. You may choose\n// either license.\n//\n// If you elect to accept the software under the Apache License, Version 2.0,\n// the following applies:\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    https://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n//-----------------------------------------------------------------------------\n\n'use strict';\n\nconst constants = require(\"../constants.js\");\nconst Message = require(\"./base.js\");\n\n/**\n * Executes a Protocol Negotiation RPC function\n *\n * @class ProtocolMessage\n * @extends {Message}\n */\nclass ProtocolMessage extends Message {\n  /**\n   * Serializes the ProtocolMessage function arguments\n   *\n   * @param {object} buf input arguments\n   */\n  encode(buf) {\n    buf.writeUInt8(constants.TNS_MSG_TYPE_PROTOCOL);\n    buf.writeUInt8(6); // protocol version (8.1+)\n    buf.writeUInt8(0); // \"array\" terminator\n    buf.writeStr(\"node-oracledb\"); // unique name for driver\n    buf.writeUInt8(0);\n  }\n  processMessage(buf, messageType) {\n    if (messageType === constants.TNS_MSG_TYPE_PROTOCOL) {\n      this.processProtocolInfo(buf);\n      this.endOfResponse = !this.connection.nscon.endOfRequestSupport;\n    } else {\n      super.processMessage(buf, messageType);\n    }\n  }\n  processProtocolInfo(buf) {\n    this.serverVersion = buf.readUInt8();\n    buf.skipUB1();\n    this.serverBanner = buf.readNullTerminatedBytes(48);\n    buf.caps.charSetID = buf.readUInt16LE();\n    this.serverFlags = buf.readUInt8();\n    const num_elem = buf.readUInt16LE();\n    if (num_elem > 0) {\n      // skip elements\n      buf.skipBytes(num_elem * 5);\n    }\n    const fdoLen = buf.readUInt16BE();\n    const fdo = buf.readBytes(fdoLen);\n    const ix = 6 + fdo[5] + fdo[6];\n    buf.caps.nCharsetId = (fdo[ix + 3] << 8) + fdo[ix + 4];\n    const serverCompileCaps = buf.readBytesWithLength();\n    if (serverCompileCaps) {\n      this.serverCompileCaps = Buffer.from(serverCompileCaps);\n      buf.caps.adjustForServerCompileCaps(this.serverCompileCaps, this.connection.nscon);\n\n      // Set the maximum OSON field name size\n      if (buf.caps.ttcFieldVersion >= constants.TNS_CCAP_FIELD_VERSION_23_1) {\n        this.connection._osonMaxFieldNameSize = 65535;\n      } else {\n        this.connection._osonMaxFieldNameSize = 255;\n      }\n    }\n    const serverRunTimeCaps = buf.readBytesWithLength();\n    if (serverRunTimeCaps) {\n      this.serverRunTimeCaps = Buffer.from(serverRunTimeCaps);\n      buf.caps.adjustForServerRuntimeCaps(this.serverRunTimeCaps);\n    }\n  }\n}\nmodule.exports = ProtocolMessage;","map":{"version":3,"names":["constants","require","Message","ProtocolMessage","encode","buf","writeUInt8","TNS_MSG_TYPE_PROTOCOL","writeStr","processMessage","messageType","processProtocolInfo","endOfResponse","connection","nscon","endOfRequestSupport","serverVersion","readUInt8","skipUB1","serverBanner","readNullTerminatedBytes","caps","charSetID","readUInt16LE","serverFlags","num_elem","skipBytes","fdoLen","readUInt16BE","fdo","readBytes","ix","nCharsetId","serverCompileCaps","readBytesWithLength","Buffer","from","adjustForServerCompileCaps","ttcFieldVersion","TNS_CCAP_FIELD_VERSION_23_1","_osonMaxFieldNameSize","serverRunTimeCaps","adjustForServerRuntimeCaps","module","exports"],"sources":["C:/Users/Koliv/Desktop/Software/my-react-app/node_modules/oracledb/lib/thin/protocol/messages/protocol.js"],"sourcesContent":["// Copyright (c) 2022, 2023, Oracle and/or its affiliates.\n\n//-----------------------------------------------------------------------------\n//\n// This software is dual-licensed to you under the Universal Permissive License\n// (UPL) 1.0 as shown at https://oss.oracle.com/licenses/upl and Apache License\n// 2.0 as shown at http://www.apache.org/licenses/LICENSE-2.0. You may choose\n// either license.\n//\n// If you elect to accept the software under the Apache License, Version 2.0,\n// the following applies:\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    https://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n//-----------------------------------------------------------------------------\n\n'use strict';\n\nconst constants = require(\"../constants.js\");\nconst Message = require(\"./base.js\");\n\n/**\n * Executes a Protocol Negotiation RPC function\n *\n * @class ProtocolMessage\n * @extends {Message}\n */\nclass ProtocolMessage extends Message {\n\n  /**\n   * Serializes the ProtocolMessage function arguments\n   *\n   * @param {object} buf input arguments\n   */\n  encode(buf) {\n    buf.writeUInt8(constants.TNS_MSG_TYPE_PROTOCOL);\n    buf.writeUInt8(6);                          // protocol version (8.1+)\n    buf.writeUInt8(0);                          // \"array\" terminator\n    buf.writeStr(\"node-oracledb\");              // unique name for driver\n    buf.writeUInt8(0);\n  }\n\n  processMessage(buf, messageType) {\n    if (messageType === constants.TNS_MSG_TYPE_PROTOCOL) {\n      this.processProtocolInfo(buf);\n      this.endOfResponse = !this.connection.nscon.endOfRequestSupport;\n    } else {\n      super.processMessage(buf, messageType);\n    }\n  }\n\n  processProtocolInfo(buf) {\n    this.serverVersion = buf.readUInt8();\n    buf.skipUB1();\n    this.serverBanner = buf.readNullTerminatedBytes(48);\n    buf.caps.charSetID = buf.readUInt16LE();\n    this.serverFlags = buf.readUInt8();\n    const num_elem = buf.readUInt16LE();\n    if (num_elem > 0) {                       // skip elements\n      buf.skipBytes(num_elem * 5);\n    }\n    const fdoLen = buf.readUInt16BE();\n    const fdo = buf.readBytes(fdoLen);\n    const ix = 6 + fdo[5] + fdo[6];\n    buf.caps.nCharsetId = (fdo[ix + 3] << 8) + fdo[ix + 4];\n    const serverCompileCaps = buf.readBytesWithLength();\n    if (serverCompileCaps) {\n      this.serverCompileCaps = Buffer.from(serverCompileCaps);\n      buf.caps.adjustForServerCompileCaps(this.serverCompileCaps, this.connection.nscon);\n\n      // Set the maximum OSON field name size\n      if (buf.caps.ttcFieldVersion >= constants.TNS_CCAP_FIELD_VERSION_23_1) {\n        this.connection._osonMaxFieldNameSize = 65535;\n      } else {\n        this.connection._osonMaxFieldNameSize = 255;\n      }\n    }\n    const serverRunTimeCaps = buf.readBytesWithLength();\n    if (serverRunTimeCaps) {\n      this.serverRunTimeCaps = Buffer.from(serverRunTimeCaps);\n      buf.caps.adjustForServerRuntimeCaps(this.serverRunTimeCaps);\n    }\n  }\n\n}\n\nmodule.exports = ProtocolMessage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}